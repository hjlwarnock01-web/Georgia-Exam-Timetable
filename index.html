<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📚 My Exam Study Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 968px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-display {
            text-align: center;
            margin: 30px 0;
        }

        .timer-display .time {
            font-size: 4em;
            font-weight: bold;
            color: #667eea;
            font-family: 'Courier New', monospace;
        }

        .timer-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .subject-selector {
            margin: 20px 0;
        }

        .subject-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1em;
            background: white;
            cursor: pointer;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .subject-breakdown {
            margin-top: 20px;
        }

        .subject-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
            align-items: center;
        }

        .subject-item:last-child {
            border-bottom: none;
        }

        .subject-name {
            font-weight: 600;
        }

        .subject-time {
            color: #667eea;
            font-weight: 600;
        }

        .tip-content {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 20px;
            border-radius: 10px;
            font-size: 1.1em;
            line-height: 1.6;
            color: #555;
            font-style: italic;
        }

        .week-section {
            margin-bottom: 30px;
        }

        .week-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 1.2em;
        }

        .day-card {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .day-title {
            font-weight: 600;
            font-size: 1.1em;
            color: #2d3748;
        }

        .exam-badge {
            background: #f56565;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .rest-badge {
            background: #48bb78;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .session-list {
            margin-top: 10px;
        }

        .session-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            margin-bottom: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: move;
        }

        .session-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .session-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .session-item.drag-over {
            border-top: 3px solid #667eea;
        }

        .drag-handle {
            cursor: grab;
            color: #a0aec0;
            margin-right: 10px;
            font-size: 1.2em;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .session-checkbox {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .session-text {
            flex: 1;
            color: #2d3748;
        }

        .session-text.completed {
            text-decoration: line-through;
            color: #a0aec0;
        }

        .subject-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }

        .badge-life {
            background: #fef5e7;
            color: #f39c12;
        }

        .badge-math {
            background: #ebf8ff;
            color: #3182ce;
        }

        .badge-english {
            background: #f0fff4;
            color: #38a169;
        }

        .badge-consumer {
            background: #fef5f5;
            color: #e53e3e;
        }

        .badge-geography {
            background: #f7fafc;
            color: #805ad5;
        }

        .badge-economics {
            background: #fffaf0;
            color: #dd6b20;
        }

        .catchup-item {
            background: #fff5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #f56565;
        }

        .catchup-item .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .catchup-title {
            font-weight: 600;
            color: #c53030;
        }

        .catchup-date {
            font-size: 0.85em;
            color: #718096;
        }

        .catchup-text {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .btn-small {
            padding: 6px 15px;
            font-size: 0.85em;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
            font-style: italic;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>📚 My Exam Study Tracker</h1>
            <p class="subtitle">Stay organized, track your progress, and ace those exams!</p>
            <p class="subtitle">Start Date: Saturday, October 25, 2025</p>
        </header>

        <div class="grid">
            <div>
                <div class="card">
                    <h2>⏱️ Study Timer</h2>
                    <div class="subject-selector">
                        <label for="currentSubject"><strong>What are you studying?</strong></label>
                        <select id="currentSubject">
                            <option value="">Select a subject...</option>
                            <option value="Life Sciences P1">🔴 Life Sciences P1</option>
                            <option value="Life Sciences P2">🔴 Life Sciences P2</option>
                            <option value="Mathematics P1">🔴 Mathematics P1</option>
                            <option value="Mathematics P2">🔴 Mathematics P2</option>
                            <option value="English P1">🟢 English P1</option>
                            <option value="English P2">🟢 English P2</option>
                            <option value="English P3">🟢 English P3</option>
                            <option value="Geography P1">🟡 Geography P1</option>
                            <option value="Geography P2">🟡 Geography P2</option>
                            <option value="Economics P1">🔴 Economics P1</option>
                            <option value="Economics P2">🔴 Economics P2</option>
                            <option value="Consumer Studies">🔴 Consumer Studies</option>
                        </select>
                    </div>
                    <div class="timer-display">
                        <div class="time" id="timerDisplay">00:00:00</div>
                        <div id="currentStudySubject" style="color: #718096; margin-top: 10px;"></div>
                    </div>
                    <div class="timer-controls">
                        <button class="btn btn-success" id="startBtn" onclick="startTimer()">▶️ Start</button>
                        <button class="btn btn-danger" id="pauseBtn" onclick="pauseTimer()" disabled>⏸️ Pause</button>
                        <button class="btn btn-primary" id="resetBtn" onclick="resetTimer()">🔄 Reset</button>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2>📅 Study Timetable & Checklist</h2>
                    <div class="progress-bar">
                        <div class="progress-fill" id="overallProgress" style="width: 0%">0%</div>
                    </div>
                    <div id="timetableContainer"></div>
                </div>
            </div>

            <div>
                <div class="card">
                    <h2>💡 Daily Tip</h2>
                    <div class="tip-content" id="dailyTip"></div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2>📊 Study Analytics</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalTime">0h</div>
                            <div class="stat-label">Total Time</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="todayTime">0h</div>
                            <div class="stat-label">Today</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="sessionCount">0</div>
                            <div class="stat-label">Sessions Done</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="averageSession">0m</div>
                            <div class="stat-label">Avg Session</div>
                        </div>
                    </div>

                    <div class="subject-breakdown">
                        <h3 style="margin-bottom: 15px; color: #2d3748;">Time by Subject</h3>
                        <div id="subjectTimeBreakdown"></div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2>🎯 Catch-Up Box</h2>
                    <p style="color: #718096; margin-bottom: 15px;">Tasks that missed their scheduled time are automatically added here.</p>
                    <div id="catchupContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let timerInterval = null;
        let elapsedSeconds = 0;
        let isRunning = false;
        let currentSession = null;
        let timerStartTime = null;

        const dailyTips = [
            "🧠 Take a 5-10 minute break every hour. Your brain needs it!",
            "💧 Stay hydrated! Keep water nearby while studying.",
            "📝 Active recall is more effective than re-reading. Test yourself!",
            "🎯 Focus on understanding concepts, not just memorizing.",
            "🌅 Study your hardest subjects when you're most alert.",
            "✅ Break big topics into smaller chunks. Progress = motivation!",
            "🎵 Try different study environments. Change can boost focus!",
            "😴 Sleep is crucial for memory consolidation. Don't skip it!",
            "🍎 Healthy snacks fuel your brain. Avoid sugar crashes!",
            "👥 Explain concepts to someone else. Teaching = learning!",
            "📱 Put your phone in another room. Out of sight, out of mind!",
            "🎨 Use colors, diagrams, and mind maps for visual learning.",
            "⏰ Use the Pomodoro Technique: 25 min study, 5 min break.",
            "🎯 Set specific goals for each study session.",
            "🌟 Celebrate small wins! You're making progress every day.",
            "🧘 Start with 2 minutes of deep breathing to focus your mind.",
            "📚 Review your notes within 24 hours of learning something new.",
            "🎪 Make studying fun! Create mnemonics and silly associations.",
            "💪 Your brain is a muscle. The more you use it, the stronger it gets!",
            "🌈 Stay positive! You've got this! One session at a time."
        ];

        const timetableData = {
            "Week 2: Oct 25-31 ⚠️ English P1 Oct 29, Math P1 Oct 31": [
                {
                    date: "SAT Oct 25",
                    sessions: [
                        { subject: "Life Sciences P1", topic: "Receptors", id: "sat25-1" },
                        { subject: "Life Sciences P1", topic: "Receptors", id: "sat25-2" },
                        { subject: "Life Sciences P1", topic: "Homeostasis", id: "sat25-3" }
                    ]
                },
                {
                    date: "SUN Oct 26",
                    sessions: [
                        { subject: "Mathematics P1", topic: "Calculus", id: "sun26-1" },
                        { subject: "Mathematics P1", topic: "Calculus", id: "sun26-2" },
                        { subject: "Mathematics P1", topic: "Algebra", id: "sun26-3" }
                    ]
                },
                {
                    date: "MON Oct 27",
                    note: "2 days before English P1 - INTENSIVE",
                    sessions: [
                        { subject: "English P1", topic: "Comprehension", id: "mon27-1" },
                        { subject: "English P1", topic: "Comprehension", id: "mon27-2" },
                        { subject: "English P1", topic: "Language in Context", id: "mon27-3" }
                    ]
                },
                {
                    date: "TUE Oct 28",
                    note: "1 day before English P1 - INTENSIVE",
                    sessions: [
                        { subject: "English P1", topic: "Language Skills Review", id: "tue28-1" },
                        { subject: "English P1", topic: "Mock Exam Practice", id: "tue28-2" },
                        { subject: "English P1", topic: "Final Review", id: "tue28-3" }
                    ]
                },
                {
                    date: "WED Oct 29",
                    exam: "English P1"
                },
                {
                    date: "THU Oct 30",
                    note: "1 day before Math P1 - INTENSIVE, TUTORING 4-5pm",
                    sessions: [
                        { subject: "Mathematics P1", topic: "Functions & Graphs Review", id: "thu30-1" },
                        { subject: "Mathematics P1", topic: "Finance & Probability", id: "thu30-2" },
                        { subject: "Mathematics P1", topic: "Mock P1 + Review", id: "thu30-3" }
                    ]
                },
                {
                    date: "FRI Oct 31",
                    exam: "Math P1",
                    note: "TUTORING 4-5pm"
                }
            ],
            "Week 3: Nov 1-7 ⚠️ Math P2 Nov 3": [
                {
                    date: "SAT Nov 1",
                    note: "2 days before Math P2 - INTENSIVE",
                    sessions: [
                        { subject: "Mathematics P2", topic: "Euclidean Geometry", id: "sat1-1" },
                        { subject: "Mathematics P2", topic: "Euclidean Geometry", id: "sat1-2" },
                        { subject: "Mathematics P2", topic: "Statistics", id: "sat1-3" }
                    ]
                },
                {
                    date: "SUN Nov 2",
                    note: "1 day before Math P2 - INTENSIVE",
                    sessions: [
                        { subject: "Mathematics P2", topic: "Analytical Geometry", id: "sun2-1" },
                        { subject: "Mathematics P2", topic: "Trigonometry", id: "sun2-2" },
                        { subject: "Mathematics P2", topic: "Mock P2 + Review", id: "sun2-3" }
                    ]
                },
                {
                    date: "MON Nov 3",
                    exam: "Math P2"
                },
                {
                    date: "TUE Nov 4",
                    sessions: [
                        { subject: "Consumer Studies", topic: "Food & Nutrition", id: "tue4-1" },
                        { subject: "Consumer Studies", topic: "Food & Nutrition", id: "tue4-2" },
                        { subject: "Consumer Studies", topic: "Clothing", id: "tue4-3" }
                    ]
                },
                {
                    date: "WED Nov 5",
                    note: "No tutoring - math exams done!",
                    sessions: [
                        { subject: "Life Sciences P2", topic: "Evolution", id: "wed5-1" },
                        { subject: "Life Sciences P2", topic: "Evolution", id: "wed5-2" },
                        { subject: "Life Sciences P2", topic: "DNA", id: "wed5-3" }
                    ]
                },
                {
                    date: "THU Nov 6",
                    note: "FULL DAY, NO tutoring",
                    sessions: [
                        { subject: "Consumer Studies", topic: "Entrepreneurship", id: "thu6-1" },
                        { subject: "Consumer Studies", topic: "Entrepreneurship", id: "thu6-2" },
                        { subject: "Consumer Studies", topic: "The Consumer", id: "thu6-3" }
                    ]
                },
                {
                    date: "FRI Nov 7",
                    rest: true
                }
            ],
            "Week 4: Nov 8-14 ⚠️ Geo P1 Nov 12, Eng P2 Nov 13, Life Sci P1 Nov 14": [
                {
                    date: "SAT Nov 8",
                    sessions: [
                        { subject: "Life Sciences P1", topic: "Homeostasis", id: "sat8-1" },
                        { subject: "Life Sciences P1", topic: "Human Reproduction", id: "sat8-2" },
                        { subject: "Life Sciences P1", topic: "Human Reproduction", id: "sat8-3" }
                    ]
                },
                {
                    date: "SUN Nov 9",
                    sessions: [
                        { subject: "Life Sciences P2", topic: "DNA", id: "sun9-1" },
                        { subject: "Life Sciences P2", topic: "Meiosis", id: "sun9-2" },
                        { subject: "Life Sciences P2", topic: "Meiosis", id: "sun9-3" }
                    ]
                },
                {
                    date: "MON Nov 10",
                    note: "2 days before Geo P1 - INTENSIVE",
                    sessions: [
                        { subject: "Geography P1", topic: "Climatology", id: "mon10-1" },
                        { subject: "Geography P1", topic: "Climatology", id: "mon10-2" },
                        { subject: "Geography P1", topic: "Geomorphology", id: "mon10-3" }
                    ]
                },
                {
                    date: "TUE Nov 11",
                    note: "1 day before Geo P1 - INTENSIVE",
                    sessions: [
                        { subject: "Geography P1", topic: "Geomorphology", id: "tue11-1" },
                        { subject: "Geography P1", topic: "Mapwork", id: "tue11-2" },
                        { subject: "Geography P1", topic: "Mock P1 + Review", id: "tue11-3" }
                    ]
                },
                {
                    date: "WED Nov 12",
                    exam: "Geography P1",
                    note: "Evening study - 1 day before Eng P2",
                    sessions: [
                        { subject: "English P2", topic: "Poetry + Literature", id: "wed12-1" },
                        { subject: "English P2", topic: "Poetry + Literature", id: "wed12-2" }
                    ]
                },
                {
                    date: "THU Nov 13",
                    exam: "English P2 (LAST English!)",
                    note: "Afternoon study - 1 day before Life Sci P1",
                    sessions: [
                        { subject: "Life Sciences P1", topic: "Mock P1 + Review", id: "thu13-1" },
                        { subject: "Life Sciences P1", topic: "Mock P1 + Review", id: "thu13-2" }
                    ]
                },
                {
                    date: "FRI Nov 14",
                    exam: "Life Sciences P1"
                }
            ],
            "Week 5: Nov 15-21 ⚠️ Life Sci P2 Nov 17, Geo P2 Nov 18, Econ P1 Nov 19, Econ P2 Nov 21": [
                {
                    date: "SAT Nov 15",
                    note: "2 days before Life Sci P2 - INTENSIVE",
                    sessions: [
                        { subject: "Life Sciences P2", topic: "Genetics", id: "sat15-1" },
                        { subject: "Life Sciences P2", topic: "Genetics", id: "sat15-2" },
                        { subject: "Life Sciences P2", topic: "Evolution Review", id: "sat15-3" }
                    ]
                },
                {
                    date: "SUN Nov 16",
                    note: "1 day before Life Sci P2 - INTENSIVE",
                    sessions: [
                        { subject: "Life Sciences P2", topic: "DNA & Meiosis Review", id: "sun16-1" },
                        { subject: "Life Sciences P2", topic: "Mock P2 Practice", id: "sun16-2" },
                        { subject: "Life Sciences P2", topic: "Mock P2 + Review", id: "sun16-3" }
                    ]
                },
                {
                    date: "MON Nov 17",
                    exam: "Life Sciences P2 (LAST Life Sci!)",
                    note: "Evening study - 1 day before Geo P2",
                    sessions: [
                        { subject: "Geography P2", topic: "Settlement Geography", id: "mon17-1" },
                        { subject: "Geography P2", topic: "Settlement Geography", id: "mon17-2" }
                    ]
                },
                {
                    date: "TUE Nov 18",
                    exam: "Geography P2 (LAST Geography!)",
                    note: "Evening study - 1 day before Econ P1",
                    sessions: [
                        { subject: "Economics P1", topic: "Macroeconomics", id: "tue18-1" },
                        { subject: "Economics P1", topic: "Economic Pursuits", id: "tue18-2" }
                    ]
                },
                {
                    date: "WED Nov 19",
                    exam: "Economics P1",
                    note: "Evening study - 2 days before Econ P2"
                },
                {
                    date: "THU Nov 20",
                    note: "FULL DAY, 1 day before Econ P2 - INTENSIVE, NO tutoring",
                    sessions: [
                        { subject: "Economics P2", topic: "Microeconomics", id: "thu20-1" },
                        { subject: "Economics P2", topic: "Microeconomics", id: "thu20-2" },
                        { subject: "Economics P2", topic: "Contemporary Issues + Review", id: "thu20-3" }
                    ]
                },
                {
                    date: "FRI Nov 21",
                    exam: "Economics P2 (LAST Economics!)"
                }
            ],
            "Week 6: Nov 22-25 ⚠️ Consumer Studies Nov 25 (FINAL EXAM!)": [
                {
                    date: "SAT Nov 22",
                    sessions: [
                        { subject: "Economics P1", topic: "Macroeconomics Review", id: "sat22-1" },
                        { subject: "Economics P1", topic: "Economic Pursuits Review", id: "sat22-2" },
                        { subject: "Economics P2", topic: "Mock P2 Review", id: "sat22-3" }
                    ]
                },
                {
                    date: "SUN Nov 23",
                    note: "2 days before Consumer - INTENSIVE",
                    sessions: [
                        { subject: "Consumer Studies", topic: "Housing Review", id: "sun23-1" },
                        { subject: "Consumer Studies", topic: "Entrepreneurship Review", id: "sun23-2" },
                        { subject: "Consumer Studies", topic: "Food & Nutrition Review", id: "sun23-3" }
                    ]
                },
                {
                    date: "MON Nov 24",
                    note: "1 day before Consumer - INTENSIVE",
                    sessions: [
                        { subject: "Consumer Studies", topic: "The Consumer + Housing Final Review", id: "mon24-1" },
                        { subject: "Consumer Studies", topic: "Mock Exam Practice", id: "mon24-2" },
                        { subject: "Consumer Studies", topic: "Mock + Final Review", id: "mon24-3" }
                    ]
                },
                {
                    date: "TUE Nov 25",
                    exam: "Consumer Studies (FINAL EXAM!)"
                }
            ]
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadDailyTip();
            loadTimetable();
            loadAnalytics();
            loadCatchupBox();
            restoreTimerState();
            updateTimerDisplay();
        });

        function loadDailyTip() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
            const tipIndex = dayOfYear % dailyTips.length;
            document.getElementById('dailyTip').textContent = dailyTips[tipIndex];
        }

        function restoreTimerState() {
            const savedState = localStorage.getItem('timerState');
            if (savedState) {
                const state = JSON.parse(savedState);
                
                if (state.isRunning) {
                    const now = Date.now();
                    const timePassed = Math.floor((now - state.startTime) / 1000);
                    elapsedSeconds = state.elapsedSeconds + timePassed;
                    
                    document.getElementById('currentSubject').value = state.subject;
                    document.getElementById('currentStudySubject').textContent = `Studying: ${state.subject}`;
                    
                    isRunning = true;
                    timerStartTime = state.startTime;
                    currentSession = {
                        subject: state.subject,
                        startTime: state.startTime,
                        elapsedSeconds: state.elapsedSeconds
                    };
                    
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('pauseBtn').disabled = false;
                    
                    timerInterval = setInterval(() => {
                        elapsedSeconds++;
                        updateTimerDisplay();
                        
                        if (elapsedSeconds % 10 === 0) {
                            saveTimerState();
                        }
                    }, 1000);
                }
            }
        }

        function saveTimerState() {
            if (isRunning && currentSession) {
                const state = {
                    isRunning: true,
                    subject: currentSession.subject,
                    startTime: timerStartTime,
                    elapsedSeconds: Math.floor((Date.now() - timerStartTime) / 1000),
                    lastUpdate: Date.now()
                };
                localStorage.setItem('timerState', JSON.stringify(state));
            } else {
                localStorage.removeItem('timerState');
            }
        }

        function startTimer() {
            const subject = document.getElementById('currentSubject').value;
            if (!subject) {
                alert('Please select a subject first!');
                return;
            }

            isRunning = true;
            timerStartTime = Date.now() - (elapsedSeconds * 1000);
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('currentStudySubject').textContent = `Studying: ${subject}`;

            currentSession = {
                subject: subject,
                startTime: timerStartTime,
                elapsedSeconds: elapsedSeconds
            };

            saveTimerState();

            timerInterval = setInterval(() => {
                elapsedSeconds++;
                updateTimerDisplay();
                
                if (elapsedSeconds % 10 === 0) {
                    saveTimerState();
                }
            }, 1000);
        }

        function pauseTimer() {
            if (!isRunning) return;

            isRunning = false;
            clearInterval(timerInterval);
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;

            localStorage.removeItem('timerState');

            if (currentSession) {
                saveSession();
            }
        }

        function resetTimer() {
            if (isRunning) {
                pauseTimer();
            }
            
            elapsedSeconds = 0;
            timerStartTime = null;
            updateTimerDisplay();
            document.getElementById('currentStudySubject').textContent = '';
            document.getElementById('currentSubject').value = '';
            currentSession = null;
            
            localStorage.removeItem('timerState');
        }

        function updateTimerDisplay() {
            const hours = Math.floor(elapsedSeconds / 3600);
            const minutes = Math.floor((elapsedSeconds % 3600) / 60);
            const seconds = elapsedSeconds % 60;
            
            document.getElementById('timerDisplay').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function saveSession() {
            const sessions = JSON.parse(localStorage.getItem('studySessions') || '[]');
            const session = {
                subject: currentSession.subject,
                duration: elapsedSeconds,
                date: new Date().toISOString(),
                timestamp: Date.now()
            };
            sessions.push(session);
            localStorage.setItem('studySessions', JSON.stringify(sessions));
            loadAnalytics();
        }

        function loadTimetable() {
            const container = document.getElementById('timetableContainer');
            const completedSessions = JSON.parse(localStorage.getItem('completedSessions') || '{}');
            
            let html = '';
            let totalSessions = 0;
            let completedCount = 0;

            for (const [week, days] of Object.entries(timetableData)) {
                html += `<div class="week-section">
                    <div class="week-header">${week}</div>`;
                
                days.forEach(day => {
                    html += `<div class="day-card">
                        <div class="day-header">
                            <div class="day-title">${day.date}</div>`;
                    
                    if (day.exam) {
                        html += `<span class="exam-badge">🎓 ${day.exam} EXAM</span>`;
                    } else if (day.rest) {
                        html += `<span class="rest-badge">✨ REST DAY</span>`;
                    }
                    
                    html += `</div>`;
                    
                    if (day.note) {
                        html += `<div style="color: #718096; font-size: 0.9em; margin-bottom: 10px;">${day.note}</div>`;
                    }
                    
                    if (day.sessions && day.sessions.length > 0) {
                        html += `<div class="session-list">`;
                        day.sessions.forEach(session => {
                            totalSessions++;
                            const isCompleted = completedSessions[session.id] || false;
                            if (isCompleted) completedCount++;
                            
                            const badgeClass = `badge-${session.subject.toLowerCase().includes('life') ? 'life' : 
                                                         session.subject.toLowerCase().includes('math') ? 'math' :
                                                         session.subject.toLowerCase().includes('english') ? 'english' :
                                                         session.subject.toLowerCase().includes('consumer') ? 'consumer' :
                                                         session.subject.toLowerCase().includes('geography') ? 'geography' :
                                                         'economics'}`;
                            
                            html += `<div class="session-item" draggable="true" data-session-id="${session.id}" data-day="${day.date}">
                                <span class="drag-handle">⋮⋮</span>
                                <input type="checkbox" class="session-checkbox" 
                                       ${isCompleted ? 'checked' : ''} 
                                       onchange="toggleSession('${session.id}', '${day.date}', '${session.subject}', '${session.topic}')">
                                <span class="session-text ${isCompleted ? 'completed' : ''}">
                                    ${session.topic}
                                </span>
                                <span class="subject-badge ${badgeClass}">${session.subject}</span>
                            </div>`;
                        });
                        html += `</div>`;
                    }
                    
                    html += `</div>`;
                });
                
                html += `</div>`;
            }
            
            container.innerHTML = html;
            
            const percentage = totalSessions > 0 ? Math.round((completedCount / totalSessions) * 100) : 0;
            document.getElementById('overallProgress').style.width = percentage + '%';
            document.getElementById('overallProgress').textContent = percentage + '%';
            
            // Add drag and drop functionality
            addDragAndDrop();
        }

        function addDragAndDrop() {
            const sessionItems = document.querySelectorAll('.session-item');
            let draggedElement = null;

            sessionItems.forEach(item => {
                item.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.innerHTML);
                });

                item.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    // Remove all drag-over classes
                    document.querySelectorAll('.drag-over').forEach(el => {
                        el.classList.remove('drag-over');
                    });
                });

                item.addEventListener('dragover', function(e) {
                    if (e.preventDefault) {
                        e.preventDefault();
                    }
                    e.dataTransfer.dropEffect = 'move';
                    
                    if (this !== draggedElement) {
                        this.classList.add('drag-over');
                    }
                    return false;
                });

                item.addEventListener('dragleave', function(e) {
                    this.classList.remove('drag-over');
                });

                item.addEventListener('drop', function(e) {
                    if (e.stopPropagation) {
                        e.stopPropagation();
                    }

                    this.classList.remove('drag-over');

                    if (draggedElement !== this) {
                        // Get parent containers
                        const draggedParent = draggedElement.parentNode;
                        const droppedParent = this.parentNode;

                        // Swap the elements
                        const draggedIndex = Array.from(draggedParent.children).indexOf(draggedElement);
                        const droppedIndex = Array.from(droppedParent.children).indexOf(this);

                        if (draggedParent === droppedParent) {
                            // Same parent - reorder
                            if (draggedIndex < droppedIndex) {
                                droppedParent.insertBefore(draggedElement, this.nextSibling);
                            } else {
                                droppedParent.insertBefore(draggedElement, this);
                            }
                        } else {
                            // Different parents - swap
                            const tempDiv = document.createElement('div');
                            draggedParent.insertBefore(tempDiv, draggedElement);
                            droppedParent.insertBefore(draggedElement, this);
                            draggedParent.insertBefore(this, tempDiv);
                            draggedParent.removeChild(tempDiv);
                        }

                        // Save the new order
                        saveSessionOrder();
                    }

                    return false;
                });
            });
        }

        function saveSessionOrder() {
            // Get all session lists
            const sessionLists = document.querySelectorAll('.session-list');
            const orderData = {};

            sessionLists.forEach(list => {
                const dayCard = list.closest('.day-card');
                const dayTitle = dayCard.querySelector('.day-title').textContent;
                const sessions = Array.from(list.querySelectorAll('.session-item'));
                
                orderData[dayTitle] = sessions.map(item => item.dataset.sessionId);
            });

            localStorage.setItem('sessionOrder', JSON.stringify(orderData));
        }

        function loadSessionOrder() {
            const orderData = JSON.parse(localStorage.getItem('sessionOrder') || '{}');
            return orderData;
        }

        function toggleSession(sessionId, date, subject, topic) {
            const completedSessions = JSON.parse(localStorage.getItem('completedSessions') || '{}');
            const catchupItems = JSON.parse(localStorage.getItem('catchupItems') || '[]');
            
            if (completedSessions[sessionId]) {
                delete completedSessions[sessionId];
                
                const sessionDate = parseDate(date);
                if (sessionDate < new Date()) {
                    if (!catchupItems.find(item => item.id === sessionId)) {
                        catchupItems.push({
                            id: sessionId,
                            date: date,
                            subject: subject,
                            topic: topic,
                            addedAt: new Date().toISOString()
                        });
                    }
                }
            } else {
                completedSessions[sessionId] = true;
                
                const index = catchupItems.findIndex(item => item.id === sessionId);
                if (index > -1) {
                    catchupItems.splice(index, 1);
                }
            }
            
            localStorage.setItem('completedSessions', JSON.stringify(completedSessions));
            localStorage.setItem('catchupItems', JSON.stringify(catchupItems));
            loadTimetable();
            loadCatchupBox();
        }

        function parseDate(dateString) {
            const parts = dateString.split(' ');
            const month = parts[1];
            const day = parseInt(parts[2]);
            
            const monthMap = {
                'Oct': 9,
                'Nov': 10
            };
            
            return new Date(2025, monthMap[month], day);
        }

        function loadCatchupBox() {
            const container = document.getElementById('catchupContainer');
            const catchupItems = JSON.parse(localStorage.getItem('catchupItems') || '[]');
            const completedSessions = JSON.parse(localStorage.getItem('completedSessions') || '{}');
            
            // Define the start date (Oct 25, 2025)
            const startDate = new Date(2025, 9, 25); // Month is 0-indexed
            const today = new Date();
            
            // Sessions before Oct 25 that should be in catch-up
            const oldSessions = [
                { id: "wed22-1", date: "WED Oct 22", subject: "English P3", topic: "Creative Writing" },
                { id: "wed22-2", date: "WED Oct 22", subject: "English P3", topic: "Creative Writing" },
                { id: "wed22-3", date: "WED Oct 22", subject: "English P3", topic: "Transactional Writing" }
            ];
            
            // Add old sessions to catch-up if not completed and not already there
            oldSessions.forEach(session => {
                if (!completedSessions[session.id] && !catchupItems.find(item => item.id === session.id)) {
                    catchupItems.push({
                        id: session.id,
                        date: session.date,
                        subject: session.subject,
                        topic: session.topic,
                        addedAt: new Date().toISOString()
                    });
                }
            });
            
            // Auto-add overdue sessions from timetable
            for (const [week, days] of Object.entries(timetableData)) {
                days.forEach(day => {
                    if (day.sessions) {
                        const sessionDate = parseDate(day.date);
                        day.sessions.forEach(session => {
                            if (sessionDate < today && 
                                !completedSessions[session.id] && 
                                !catchupItems.find(item => item.id === session.id)) {
                                catchupItems.push({
                                    id: session.id,
                                    date: day.date,
                                    subject: session.subject,
                                    topic: session.topic,
                                    addedAt: new Date().toISOString()
                                });
                            }
                        });
                    }
                });
            }
            
            localStorage.setItem('catchupItems', JSON.stringify(catchupItems));
            
            if (catchupItems.length === 0) {
                container.innerHTML = '<div class="empty-state">🎉 No catch-up items! You\'re all caught up!</div>';
                return;
            }
            
            let html = '';
            catchupItems.forEach(item => {
                html += `<div class="catchup-item">
                    <div class="item-header">
                        <div class="catchup-title">${item.subject}</div>
                        <div class="catchup-date">Due: ${item.date}</div>
                    </div>
                    <div class="catchup-text">${item.topic}</div>
                    <button class="btn btn-success btn-small" onclick="completeCatchup('${item.id}')">✅ Mark as Done</button>
                </div>`;
            });
            
            container.innerHTML = html;
        }

        function completeCatchup(sessionId) {
            const completedSessions = JSON.parse(localStorage.getItem('completedSessions') || '{}');
            const catchupItems = JSON.parse(localStorage.getItem('catchupItems') || '[]');
            
            completedSessions[sessionId] = true;
            const index = catchupItems.findIndex(item => item.id === sessionId);
            if (index > -1) {
                catchupItems.splice(index, 1);
            }
            
            localStorage.setItem('completedSessions', JSON.stringify(completedSessions));
            localStorage.setItem('catchupItems', JSON.stringify(catchupItems));
            loadTimetable();
            loadCatchupBox();
        }

        function loadAnalytics() {
            const sessions = JSON.parse(localStorage.getItem('studySessions') || '[]');
            
            let totalSeconds = 0;
            let todaySeconds = 0;
            const subjectTimes = {};
            const today = new Date().toDateString();
            
            sessions.forEach(session => {
                totalSeconds += session.duration;
                
                const sessionDate = new Date(session.date).toDateString();
                if (sessionDate === today) {
                    todaySeconds += session.duration;
                }
                
                if (!subjectTimes[session.subject]) {
                    subjectTimes[session.subject] = 0;
                }
                subjectTimes[session.subject] += session.duration;
            });
            
            document.getElementById('totalTime').textContent = formatHours(totalSeconds);
            document.getElementById('todayTime').textContent = formatHours(todaySeconds);
            document.getElementById('sessionCount').textContent = sessions.length;
            
            const avgSeconds = sessions.length > 0 ? totalSeconds / sessions.length : 0;
            document.getElementById('averageSession').textContent = formatMinutes(avgSeconds);
            
            const breakdownHtml = Object.entries(subjectTimes)
                .sort((a, b) => b[1] - a[1])
                .map(([subject, seconds]) => `
                    <div class="subject-item">
                        <span class="subject-name">${subject}</span>
                        <span class="subject-time">${formatHours(seconds)}</span>
                    </div>
                `).join('');
            
            document.getElementById('subjectTimeBreakdown').innerHTML = breakdownHtml || 
                '<div class="empty-state" style="padding: 20px;">No study time recorded yet</div>';
        }

        function formatHours(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            }
            return `${minutes}m`;
        }

        function formatMinutes(seconds) {
            return Math.round(seconds / 60) + 'm';
        }
    </script>
</body>
</html>
